var BaseModule=Stapes.subclass({constructor:function(){this.container="#body-content";this.main;this.configuration={};this.userData=null;this.companies=[];this.companyId=0;this.generalContants=new ConstantsModule},initialize:function(n,t,i,r){var u=this;$(document).ready(function(){if(r&&waitingModule&&waitingModule.start(),u.main=n,t){var f=$("html").attr("data-production");f&&f=="True"&&(t=t.replace(".html",".min.html"));u.loadHtml(t,i,r)}else u.init(n,r)})},init:function(n,t){try{typeof n.defineVars=="function"&&n.defineVars();typeof n.defineView=="function"&&n.defineView();typeof n.defineValidator=="function"&&n.defineValidator();typeof n.defineEvents=="function"&&n.defineEvents();this.beReady()}catch(i){console.error(i)}finally{t&&waitingModule&&waitingModule.stop()}},beReady:function(){this.emit("ready")},loadHtml:function(n,t,i){var r=this;t&&(this.container=t);useApplicationIIS&&n.startsWith(applicationISSPrefixModule)==!1&&(n="/"+applicationISSPrefixModule+n);$(this.container).load(n,function(){r.init(r.main,i)})},initSpinner:function(n){var t=Ladda.create(n);return t.start(),t},defaultFeedbackIcons:function(){return{valid:"fa fa-check",invalid:"fa fa-times",validating:"fa fa-refresh"}},setCompanyNameTitle:function(){var n=this;$(".companyName").html(n.configuration.Comp_Name)},setTitle:function(n){$(".pageTitle").html(n)},getConfiguration:function(){var n=this,t="Configuration/"+n.getUniqueCompanyName()+"/GetConfiguration",f=window.sessionStorage.getItem("project");this.getUserData();var i={companyId:this.userData.Comp_Id,userId:this.userData.User_Id},r=function(t){t.Success?n.configuration=t.Data:bootbox.errorAlert(t.ErrorMessage)},u=function(n,t){bootbox.errorAlert(t)};$.doGetAndWait(t,i,r,u)},validateConfigurationOnline:function(n){let t=!1,i=!1;n.Cash_Id!=undefined&&n.Cash_Id!=null?t=!0:(t=!1,bootbox.errorAlert("El usuario no tiene caja ni camión configurado",function(){window.sessionStorage.setItem("user",null);window.location.href=self.getUniqueCompanyName()+"/Account/Login"}));n.AllowOffline==1||n.AllowOffline==!0||n.AllowOffline==-1?(i=!1,bootbox.errorAlert("La caja está configurada para trabajar en un ambiente local de sincronización. Por favor contactar con el administrador",function(){window.sessionStorage.setItem("user",null);window.location.href=self.getUniqueCompanyName()+"/Account/Login"})):i=!0},getUserData:function(){var t=this,n=window.sessionStorage.getItem("user");t.userData=n!=null?JSON.parse(n):null},getCompanies:function(){var n=this,t="Company/"+n.getUniqueCompanyName()+"/GetCompanies",i=function(t){t.Success?n.companies=t.Data:bootbox.errorAlert(t.ErrorMessage)},r=function(n,t){bootbox.errorAlert(t)};$.doGetAndWait(t,{},i,r)},isOnline:function(){var t=this,n=window.sessionStorage.getItem("online");return n==1},setOnline:function(n){n==!0?window.sessionStorage.setItem("online","1"):window.sessionStorage.setItem("online","0")},getUniqueCompanyName:function(){let n=sessionStorage.getItem("compName");return(n==undefined||n==null||n.trim()=="")&&sessionStorage.setItem("compName",null),n},logout:function(){window.sessionStorage.clear();let n="/Account/Login";useApplicationIIS&&(n="/"+applicationISSPrefixModule+n);window.location.href=n},decrypWord:function(n){var f=this,t="",i={word:n},r=function(n){n.Success?t=n.Data.word:bootbox.errorAlert(n.ErrorMessage)},u=function(n){bootbox.errorAlert(n)};return $.doGetAndWait("Configuration/DecrytWord",i,r,u),t},formToObject:function(n){var t={};return $(n).find("input, select").each(function(){var r,u,f,e,i,n;$.trim(this.name).length>0&&(r=$(this).attr("serializable"),r&&r!=!0||(u=$(this).attr("isRef"),u&&u=="true"?(f=$(this).attr("refAttribute"),f&&(e={},e[f]=$(this).val(),t[this.name]=e)):$(this).is(":radio")?(i=$("input:radio[name="+this.name+"]:checked").val(),t[this.name]=i):$(this).is(":checkbox")?(i=$("input:checkbox[name="+this.name+"]:checked").val(),t[this.name]=i):$(this).attr("data-datepicker")?$.trim($(this).val()).length>0&&(n=$(this).parents(".date")?$(this).parents(".date").datepicker("getDate"):$(this).datepicker("getDate"),n&&(n=n.toISOString(),t[this.name]=n)):t[this.name]=$(this).data().type=="int"?parseInt($(this).val()):$(this).data().type=="float"?parseFloat($(this).val()):$(this).val()))}),$(n).find("textarea").each(function(){var n,i,r,u;$.trim(this.name).length>0&&(n=$(this).attr("serializable"),n&&n!==!0||(i=$(this).attr("isRef"),i&&i==="true"?(r=$(this).attr("refAttribute"),r&&(u={},u[r]=$(this).val(),t[this.name]=u)):t[this.name]=$(this).val()))}),t},loadForm:function(n,t){t&&$(n).find(":input").each(function(){var n,r,i;$.trim(this.name).length>0&&(n=t[this.name],n!=undefined&&($(this).is(":radio")?($("input[name="+this.name+"]").filter("[value="+n+"]").prop("checked",!0),$("input[name="+this.name+"]").trigger("change")):$(this).is(":checkbox")?($("input[name="+this.name+"]").prop("checked",n),$("input[name="+this.name+"]").trigger("change")):$(this).attr("data-datepicker")||$(this).attr("data-date")?(r=n.replace("/Date(","").replace(")/",""),i=new Date(parseInt(r)),$(this).attr("data-datepicker")?$(this).parent().hasClass("date")?(console.log(this.name),$(this).parent(".date").datepicker("update",i)):(console.log(this.name),$(this).datepicker("update",i)):(i=moment(new Date(parseInt(r))).format("DD/MM/YYYY"),$(this).val(i))):$(this).val(n)))})},createDatePicker:function(n,t){var i=(t?t+" ":"")+n;$(i).datepicker({format:"dd/mm/yyyy",language:"es",autoclose:!0,disableTouchKeyboard:!0,uiLibrary:"bootstrap4"})},createDateTimePicker:function(n,t){var i=(t?t+" ":"")+n;$(i).datetimepicker({showClose:!0,keepOpen:!1,format:"DD/MM/YYYY hh:mm:ss a",showTodayButton:!0,uiLibrary:"bootstrap4"})},validate:function(n){var t=$(n).data("bootstrapValidator");return t?(t.validate(),t.isValid()):!1},isValidField:function(n,t){var i=$(n).data("bootstrapValidator");return i?(i.revalidateField(t),i.isValidField(t)):!1},revalidateField:function(n,t){var i=$(n).data("bootstrapValidator");i&&i.revalidateField(t)},resetField:function(n,t,i){var r=$(n).data("bootstrapValidator");r&&r.resetField(t,i)},resetForm:function(n){var t=$(n).data("bootstrapValidator");t&&t.resetForm(!0)},clearForm:function(n){return $(n).find(":input:not(select)").each(function(){$(this).is(":radio")||$(this).is(":checkbox")||$(this).val("")}),$(n).find("select").each(function(){$(this).val($(this).find("option:first").val())}),{}},setSelectControl:function(n){var t=this;n!=undefined&&n!=null&&($(n).select(),$(n).focus())},datePickerGetValue:function(n){let t=$(n).val();return new Date(t)},datePickerSetValue:function(n,t){$(n).datepicker("value",t);$(n).val(t)},loadCombo:function(n,t,i,r,u){var o=this,e=$(n),f;for(e.html(""),f=0;f<t.length;f++)e.append('<option value="'+t[f][i]+'">'+t[f][r]+"<\/option>");u!=undefined&&e.val(u)},loadComboNullValue:function(n,t,i,r,u,f,e,o){var c=this,s=$(n),h;for(s.html(""),o&&s.append('<option value="'+f+'">'+e+"<\/option>"),h=0;h<t.length;h++)s.append('<option value="'+t[h][i]+'">'+t[h][r]+"<\/option>");o==!1&&s.append('<option value="'+f+'">'+e+"<\/option>");u!=undefined&&s.val(u)},loadComboWithTags:function(n,t,i,r,u,f){var s=this,o=$(n),e;for(o.html(""),e=0;e<t.length;e++)o.append('<option value="'+t[e][i]+'" data-tag="'+t[e][u]+'">'+t[e][r]+"<\/option>");f!=undefined&&o.val(f)},loadComboMonthlyDays:function(n){var r=this,i=$(n),t;for(i.html(""),t=1;t<30;t++)i.append('<option value="'+t+'">'+t+"<\/option>")},dateTableFormatter:function(n){var t="";return n!=undefined&&n!=null&&(t=n.replace("/Date(","").replace(")/",""),t=moment(new Date(parseInt(t))).format("DD/MM/YYYY")),t},dateTimeTableFormatter:function(n){var t="",i;return n!=undefined&&n!=null&&(t=n.replace("/Date(","").replace(")/",""),i=moment(parseInt(t)),t=i.format("DD/MM/YYYY hh:mm:ss a")),t},formatDate:function(n){var t="";return n!=undefined&&n!=null&&(t=n.replace("/Date(","").replace(")/",""),t=moment(parseInt(t)).format("DD/MM/YYYY")),t},formatDateTime:function(n){var t="";return n!=undefined&&n!=null&&(t=n.replace("/Date(","").replace(")/",""),t=moment(parseInt(t)).format("DD/MM/YYYY hh:mm:ss a")),t},dateTimeTableFormatterPurchase:function(n){var t="",i;return n!==undefined&&n!==null&&(t=n.replace("/Date(","").replace(")/",""),i=isNaN(n)?moment(t):moment(parseInt(t)),t=i.format("DD/MM/YYYY hh:mm:ss a")),t},dateTableFormatterPurchase:function(n){var t="",i;return n!==undefined&&n!==null&&(t=n.replace("/Date(","").replace(")/",""),i=isNaN(n)?moment(t):moment(parseInt(t)),t=i.format("DD/MM/YYYY")),t},formatDateISO:function(n){var t="";return n!=undefined&&n!=null&&(t=n.replace("/Date(","").replace(")/",""),t=new Date(parseInt(t)).toISOString()),t},formatDateToLong:function(n){var t=0;return n!=undefined&&n!=null&&(t=n.replace("/Date(","").replace(")/",""),t=parseInt(t)),t},round:function(n,t){var i=n;return t>0&&(i=Math.round(n/t)*t),i},litersFormat:function(n,t){var r=this,i="";if(t!=undefined&&t>0){let u=r.padLeft("0",t,"0");i=numeral(parseFloat(n)).format("0,0.["+u+"]")}else i=numeral(parseFloat(n)).format("0,0.0[0]");return i},priceFormat:function(n){var t=this;return numeral(parseFloat(n)).format("0,0"+t.getDecimals())},priceLocalFormat:function(n){var t=this;return numeral(parseFloat(n)).format("0,0"+t.getDecimals())+" "+t.getLocalCurrencySymbol()},priceForeignFormat:function(n){var t=this;return numeral(parseFloat(n)).format("0,0"+t.getDecimals())+" "+t.getForeignCurrencySymbol()},numberFormat:function(n){var t=this;return numeral(parseFloat(n)).format("0,0")},numberFormatWithSelf:function(n,t){return numeral(parseFloat(t)).format("0,0"+n.getDecimals())},numberFormatUnitMeasurement:function(n){var t=this;return(t.configuration.Truck_Granel?t.litersFormat(n):t.numberFormat(n))+" "+t.getCurrentUnitMeasurementSale()},numberFormatUnitMeasurementProductName:function(n,t){var i=this;return i.numberFormat(n)+" "+t},cleanNumberFormat:function(n){return numeral().unformat(n)},decimalFormat:function(n){var t=this;return numeral(parseFloat(n)).format("0"+t.getDecimals())},bulkAmountFormat:function(n){var t=this;return numeral(parseFloat(n)).format("0.0")},getDecimals:function(){var t=this,n="",i;if(t.configuration.Gen_Decimals!=undefined&&t.configuration.Gen_Decimals>0)for(n=".",i=0;i<t.configuration.Gen_Decimals;i++)n=n+"0";return n},formatDateJson:function(n){var i=this,t;return i.useISODateFormat=!1,t=n.parent(".date").datepicker("getDate"),t&&(t=i.useISODateFormat?t.toISOString():i.formatDatetoMSJSON(t)),t},formatDatetoMSJSON:function(n){return"/Date("+n.getTime()+")/"},formatDatetimeToUTC:function(n){return new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()))},formatInvoiceConsecutive:function(n,t,i,r){var u=this;try{return(r==undefined||r==null)&&(r=""),r+u.padLeft(n,3,"0")+"-"+u.padLeft(t,2,"0")+"-"+u.padLeft(i,9,"0")}catch(f){throw f;}},distance:function(n,t,i,r){var o=this,u=.017453292519943295,f=Math.cos,e=.5-f((i-n)*u)/2+f(n*u)*f(i*u)*(1-f((r-t)*u))/2;return 12742e3*Math.asin(Math.sqrt(e))},formatInvoiceType:function(n){var i=this,t="";return n=="FCO"?t="Factura Contado":n=="FCR"?t="Factura Crédito":n=="NCO"?t="Nota Contado":n=="NCR"?t="Nota Crédito":n=="COT"&&(t="Cotización"),t},getLocalCurrencyName:function(){var n=this,t="Local";return n.configuration&&n.configuration.Local_Currency_Name&&(t=n.configuration.Local_Currency_Name),t},getForeignCurrencyName:function(){var n=this,t="Extranjero";return n.configuration&&n.configuration.Foreign_Currency_Name&&(t=n.configuration.Foreign_Currency_Name),t},getLocalCurrencySymbol:function(){var n=this,t="CRC";return n.configuration&&n.configuration.Local_Currency_Symbol&&(t=n.configuration.Local_Currency_Symbol),t},getForeignCurrencySymbol:function(){var n=this,t="DOL";return n.configuration&&n.configuration.Foreign_Currency_Symbol&&(t=n.configuration.Foreign_Currency_Symbol),t},getUnitMeasurementBulkSale:function(){var n=this,t="Litros";return n.configuration&&n.configuration.Unit_Measurement_Bulk_Sale&&(t=n.configuration.Unit_Measurement_Bulk_Sale),t},getUnitMeasurementSymbolBulkSale:function(){var n=this,t="L.";return n.configuration&&n.configuration.Unit_Measurement_Symbol_Bulk_Sale&&(t=n.configuration.Unit_Measurement_Symbol_Bulk_Sale),t},getUnitMeasurementCylinderSale:function(){var n=this,t="Cilindros";return n.configuration&&n.configuration.Unit_Measurement_Cylinder_Sale&&(t=n.configuration.Unit_Measurement_Cylinder_Sale),t},getUnitMeasurementSymbolCylinderSale:function(){var n=this,t="C.";return n.configuration&&n.configuration.Unit_Measurement_Symbol_Cylinder_Sale&&(t=n.configuration.Unit_Measurement_Symbol_Cylinder_Sale),t},getUnitMeasurementTankCapacity:function(){var n=this,t="Galones";return n.configuration&&n.configuration.Unit_Measurement_Tank_Capacity&&(t=n.configuration.Unit_Measurement_Tank_Capacity),t},getUnitMeasurementSymbolTankCapacity:function(){var n=this,t="Gal.";return n.configuration&&n.configuration.Unit_Measurement_Symbol_Tank_Capacity&&(t=n.configuration.Unit_Measurement_Symbol_Tank_Capacity),t},getCurrentUnitMeasurementSale:function(){var n=this;return n.configuration.Truck_Granel?n.getUnitMeasurementBulkSale():n.getUnitMeasurementCylinderSale()},getMoney:function(){return[{id:1,name:"Local"},{id:2,name:"Extranjera"}]},getDateTimePicker:function(n){var t=n.data("DateTimePicker").date();return t==null||t=="undefined"?null:t.toDate()},setDateTimeValue:function(n,t){n.data("DateTimePicker").date(t)},getUserOptions:function(){return{EntradaSguridad:1,SalidaSeguridad:2,Depositos:3,Tesoreria:4,AplicarEntradaMercaderia:5,AnularFactura:6,LlenaMinimoAnden:7,TesoreriaAjustadoSinTolerancia:8,MarcarUsadoDepositoClientes:9,VerificarFacturasFisicas:10,AnularTrasiegos:11,FacturasManuales:12,CambioEstadoCaja:13,CierreManualCajas:14,CambiaTotalCotizaciones:15,CompletarTareasEnInstalaciones:16,CotizacionParcialCalendario:17,BorrarReplicas:18,WebReportePLC:19,QuitarReserva:20,CambiaCajaWeb:21}},getUserOptionName:function(n){var r=this;let t="",i=r.getUserOptions();switch(n){case i.EntradaSguridad:t="Entrada de Seguridad";break;case i.SalidaSeguridad:t="Salida de Seguridad";break;case i.Depositos:t="Depósitos";break;case i.Tesoreria:t="Tesorería";break;case i.AplicarEntradaMercaderia:t="Aplicar Entrada de mercadería";break;case i.AnularFactura:t="Anular facturas";break;case i.LlenaMinimoAnden:t="Llenar menos del mínimos en Anden";break;case i.TesoreriaAjustadoSinTolerancia:t="Realizar ajustes de tesorería sobre el monto de tolerancia";break;case i.MarcarUsadoDepositoClientes:t="Marcar como usado los depósitos de clientes";break;case i.VerificarFacturasFisicas:t="Verificar Facturas Físicas";break;case i.AnularTrasiegos:t="Anular Trasiegos";break;case i.FacturasManuales:t="Facturas Manuales";break;case i.CambioEstadoCaja:t="Cambio de estado de la caja";break;case i.CierreManualCajas:t="Cierre manual de cajas por usuario";break;case i.CambiaTotalCotizaciones:t="Cambia total de precio de cotizaciones";break;case i.CompletarTareasEnInstalaciones:t="Completar tareas para instalaciones";break;case i.CotizacionParcialCalendario:t="Muestra cita con la cotización aprobada parcialmente";break;case i.BorrarReplicas:t="Eliminar registros de réplica";break;case i.WebReportePLC:t="Creación de reporte de PLC";break;case i.QuitarReserva:t="Permite Cancelar Reservación de Tanques";break;case i.CambiaCajaWeb:t="Permite cambiar caja en Web"}return t},showModal:function(n){$(n).modal("show")},hideModal:function(n){$(n).modal("hide")},staticModal:function(n){$(n).modal({backdrop:"static"})},padLeft:function(n,t,i){var u=""+n,r,f;return(i==undefined||i==null)&&(i="0"),t<=0&&(t=1),r=i.repeat(t),f=r.substring(0,r.length-u.length)+u,f},getInstallationStates:function(){return{INITIAL:0,EVALUATION:1,EVALUATION_COMPLETED:2,QUOTATION:3,TANK:4,ORDER_PURSHASE:5,LIST_MATERIALS:6,INSTALLATION:7,INSTALLATION_COMPLETED:8,FINISHED:9}}});