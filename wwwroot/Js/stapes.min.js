(function(){"use strict";var f=1,i,t;Object.create||(i=function(){});var r=Array.prototype.slice,n={attributes:{},eventHandlers:{"-1":{}},guid:-1,addEvent:function(t){n.eventHandlers[t.guid][t.type]||(n.eventHandlers[t.guid][t.type]=[]);n.eventHandlers[t.guid][t.type].push({guid:t.guid,handler:t.handler,scope:t.scope,type:t.type})},addEventHandler:function(t,i,r){var u={},e,o,h,s,f,c,l;typeof t=="string"?(e=r||!1,u[t]=i):(e=i||!1,u=t);for(o in u)for(h=u[o],s=o.split(" "),f=0,c=s.length;f<c;f++)l=s[f],n.addEvent.call(this,{guid:this._guid||this._.guid,handler:h,scope:e,type:l})},addGuid:function(t,i){(!t._guid||i)&&(t._guid=f++,n.attributes[t._guid]={},n.eventHandlers[t._guid]={})},attr:function(t){return n.attributes[t]},clone:function(t){var i=n.typeOf(t);return i==="object"?n.extend({},t):i==="array"?t.slice(0):void 0},create:function(n){return Object.create?Object.create(n):(i.prototype=n,new i)},createSubclass:function(t,i){function r(){if(!(this instanceof r))throw new Error("Please use 'new' when initializing Stapes classes");this.on&&n.addGuid(this,!0);o.apply(this,arguments)}var e,o,f;t=t||{};i=i||!1;e=t.superclass.prototype;o=t.hasOwnProperty("constructor")?t.constructor:function(){};i&&n.extend(e,u);r.prototype=n.create(e);r.prototype.constructor=r;n.extend(r,{extend:function(){return n.extendThis.apply(this,arguments)},parent:e,proto:function(){return n.extendThis.apply(this.prototype,arguments)},subclass:function(t){return t=t||{},t.superclass=this,n.createSubclass(t)}});for(f in t)f!=="constructor"&&f!=="superclass"&&(r.prototype[f]=t[f]);return r},emitEvents:function(t,i,u,f){var s,o,h,e,c;for(u=u||!1,f=f||this._guid,s=r.call(n.eventHandlers[f][t]),o=0,h=s.length;o<h;o++)e=n.extend({},s[o]),c=e.scope?e.scope:this,u&&(e.type=u),e.scope=c,e.handler.call(e.scope,i,e)},extend:function(){for(var i,u,n=r.call(arguments),f=n.shift(),t=0,e=n.length;t<e;t++){i=n[t];for(u in i)f[u]=i[u]}return f},extendThis:function(){var t=r.call(arguments);return t.unshift(this),n.extend.apply(this,t)},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})},removeAttribute:function(t,i){var e,u,f,o,r;for(i=i||!1,e=n.trim(t).split(" "),u={},f=0,o=e.length;f<o;f++)r=n.trim(e[f]),r&&(u.key=r,u.oldValue=n.attr(this._guid)[r],delete n.attr(this._guid)[r],i||(this.emit("change",r),this.emit("change:"+r),this.emit("mutate",u),this.emit("mutate:"+r,u),this.emit("remove",r),this.emit("remove:"+r)),delete u.oldValue)},removeEventHandler:function(t,i){var r=n.eventHandlers[this._guid],u,f,e;if(t&&i){if(r=r[t],!r)return;for(u=0,f=r.length;u<f;u++)e=r[u].handler,e&&e===i&&(r.splice(u--,1),f--)}else t?delete r[t]:n.eventHandlers[this._guid]={}},setAttribute:function(t,i,r){var o,u,f,e;(r=r||!1,o=this.has(t),u=n.attr(this._guid)[t],i!==u)&&((n.attr(this._guid)[t]=i,r)||(this.emit("change",t),this.emit("change:"+t,i),f={key:t,newValue:i,oldValue:u||null},this.emit("mutate",f),this.emit("mutate:"+t,f),e=o?"update":"create",this.emit(e,t),this.emit(e+":"+t,i)))},trim:function(n){return n.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},typeOf:function(n){return n===null||typeof n=="undefined"?String(n):Object.prototype.toString.call(n).replace(/\[object |\]/g,"").toLowerCase()},updateAttribute:function(t,i,r){var u=this.get(t),f=n.typeOf(u),e;(f==="object"||f==="array")&&(u=n.clone(u));e=i.call(this,u,t);n.setAttribute.call(this,t,e,r||!1)}},u={emit:function(t,i){var f,u,e,r;for(i=typeof i=="undefined"?null:i,f=t.split(" "),u=0,e=f.length;u<e;u++)r=f[u],n.eventHandlers[-1].all&&n.emitEvents.call(this,"all",i,r,-1),n.eventHandlers[-1][r]&&n.emitEvents.call(this,r,i,r,-1),typeof this._guid=="number"&&(n.eventHandlers[this._guid].all&&n.emitEvents.call(this,"all",i,r),n.eventHandlers[this._guid][r]&&n.emitEvents.call(this,r,i))},off:function(){n.removeEventHandler.apply(this,arguments)},on:function(){n.addEventHandler.apply(this,arguments)}};n.Module=function(){};n.Module.prototype={each:function(t,i){var u=n.attr(this._guid),r,f;for(r in u)f=u[r],t.call(i||this,f,r)},extend:function(){return n.extendThis.apply(this,arguments)},filter:function(t){var u=[],i=n.attr(this._guid);for(var r in i)t.call(this,i[r],r)&&u.push(i[r]);return u},get:function(t){var r,i,e,u,f;if(typeof t=="string"){if(arguments.length>1){for(r={},i=0,e=arguments.length;i<e;i++)u=arguments[i],r[u]=this.get(u);return r}return this.has(t)?n.attr(this._guid)[t]:null}if(typeof t=="function")return f=this.filter(t),f.length?f[0]:null},getAll:function(){return n.clone(n.attr(this._guid))},getAllAsArray:function(){var r=[],u=n.attr(this._guid),i,t;for(i in u)t=u[i],n.typeOf(t)!=="object"||t.id||(t.id=i),r.push(t);return r},has:function(t){return typeof n.attr(this._guid)[t]!="undefined"},map:function(n,t){var i=[];return this.each(function(r,u){i.push(n.call(t||this,r,u))},t||this),i},push:function(t,i){if(n.typeOf(t)==="array")for(var r=0,u=t.length;r<u;r++)n.setAttribute.call(this,n.makeUuid(),t[r],i||!1);else n.setAttribute.call(this,n.makeUuid(),t,i||!1);return this},remove:function(t,i){return typeof t=="undefined"?(n.attributes[this._guid]={},this.emit("change remove")):typeof t=="function"?this.each(function(r,u){t(r)&&n.removeAttribute.call(this,u,i)}):n.removeAttribute.call(this,t,i||!1),this},set:function(t,i,r){if(typeof t=="object")for(var u in t)n.setAttribute.call(this,u,t[u],i||!1);else n.setAttribute.call(this,t,i,r||!1);return this},size:function(){var t=0,i=n.attr(this._guid);for(var r in i)t++;return t},update:function(t,i,r){return typeof t=="string"?n.updateAttribute.call(this,t,i,r||!1):typeof t=="function"&&this.each(function(i,r){n.updateAttribute.call(this,r,t)}),this}};t={_:n,extend:function(){return n.extendThis.apply(n.Module.prototype,arguments)},mixinEvents:function(t){return t=t||{},n.addGuid(t),n.extend(t,u)},on:function(){n.addEventHandler.apply(this,arguments)},subclass:function(t,i){return i=i||!1,t=t||{},t.superclass=i?function(){}:n.Module,n.createSubclass(t,!i)},version:"0.8.1"};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=t),exports.Stapes=t):typeof define=="function"&&define.amd?define(function(){return t}):window.Stapes=t})();